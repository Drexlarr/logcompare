<?xml version="1.0" encoding="UTF-8"?>

<testcases>
<testcase internalid="223040" name="Mensaje 0100 ErrorGwy-91">
	<node_order><![CDATA[0]]></node_order>
	<externalid><![CDATA[3413]]></externalid>
	<summary><![CDATA[<ul>
    <li>El test consiste en validar el flujo de un mensaje 0100, cuando no se pueda enviar el requerimiento al autorizador y el gateway responda con un c&oacute;digo de respuesta 91.</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>]]></summary>
	<steps><![CDATA[<div style="margin: 0px; padding: 0px;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238); line-height: normal;">
<div style="margin: 0px; padding: 0px;"><b>Precondiciones:</b></div>
<ul>
    <li>Se est&aacute; empleando el formateador sincrono de Pacifico: <strong>FSWPACIF</strong> y los formateadores asincronos de Unibanca: <strong>UBISOINT</strong> y <strong>UBINTISO</strong>.</li>
    <li>Se est&aacute; empleando el gateway as&iacute;ncrono tcp: <strong>GWSSISGO</strong>.</li>
    <li>Se emplea un simulador inyector para simular al driver y enviar el mensaje hacia el formateador <strong>UBISOINT</strong>.</li>
    <li>El gateway as&iacute;ncrono se conectar&aacute; con un simulador autorizador TCP/IP.</li>
</ul>
</div>
<p style="font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238);"><strong>Configurar el archivo de tramas</strong></p>
<ol style="font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238);">
    <li>Abrir el archivo de tramas ($HOME/tbl/lanzar_tramas/Tramas_UNIBANCA.txt).</li>
    <li>Verificar que en la primera linea se encuentre la trama correspondiente para esta prueba (<strong>MENSAJE 0100 - COMPRA</strong>), caso contrario colocarlo.</li>
</ol>
<p style="font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238);"><strong>Envio de la transaccion:</strong></p>
<ol>
    <li>Ejecutar el simulador MultiSimu.</li>
    <li>Abrir una nueva pesta&ntilde;a e ir a la ruta $HOME/log y ejecutar el comando rl para iniciar el grabado del log(ejemplo: rl nombreLog_1)</li>
    <li>Ubicarse en el simulador y seleccionar la opcion 4 (<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot;;">Opcion[4] Enviar Transacciones TCP)</span></li>
    <li>Cuando la transaccion haya finalizado, detener el grabado del log con CTRL+C.</li>
</ol>
<div style="margin: 0px; padding: 0px;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238); line-height: normal;">
<p>&nbsp;</p>
</div>
<div style="margin: 0px; padding: 0px;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238);">&nbsp;</div>
<p>&nbsp;</p>]]></steps>
	<expectedresults><![CDATA[<ol>
    <li>El formateador&nbsp;<strong>UBISOINT</strong>&nbsp;recibe el mensaje 0100 en formato ISO8583 enviado por el adquirente.</li>
    <li>El mensaje 0100 recibido por el proceso UBISOINT tiene un prcode con el formato &quot;00FATA&quot;. Para la prueba el prcode tiene un valor de 001000. (Verificar en el log la siguiente linea:&nbsp;<strong><span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);">===&gt;iso_8583_to_msg_inter: DE003[1000].</span></strong>)</li>
    <li>El formateador&nbsp;<strong>UBISOINT</strong>&nbsp;convierte el mensaje 0100 en mensaje interno del SWITCH y lo env&iacute;a al m&oacute;dulo&nbsp;<strong>SWREQ</strong>.</li>
    <li>El&nbsp;<strong>SWREQ</strong>&nbsp;recibe el mensaje 0100 y lo inserta en la tabla&nbsp;<strong>TXNLOG</strong>. (Verificar en el log:&nbsp;<span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong><span style="margin: 0px; padding: 0px;">===&gt;IMP_insert_into_txnlog: INSERTO EN LA TABLA TXNLOG.</span></strong></span>)</li>
    <li>El&nbsp;<strong>SWREQ</strong>&nbsp;envia el mensaje 0100 al formateador&nbsp;<strong>FSWPACIF.&nbsp;</strong>(Verificar en el log:&nbsp;<span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong>===&gt;snd_bco: Enviare a = (FSWPACIF) envsw:0.</strong></span>)</li>
    <li>El proceso&nbsp;<strong>FSWPACIF&nbsp;</strong>recibe el&nbsp; mensaje 0100 y lo env&iacute;a al gateway&nbsp;<strong>GWSSISGO</strong>.</li>
    <li>El autorizador recibe el mensaje y se demora en responder.</li>
    <li>El gateway&nbsp;<strong>GWSSISGO&nbsp;</strong>genera y&nbsp;env&iacute;a un mensaje 91 al formateador&nbsp;<strong>FSWPACIF</strong>. (Verificar en el log:&nbsp;<span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong><span style="margin: 0px; padding: 0px;">===&gt;IF_txrx: Receiving Message from&nbsp; SRV[GWSSISGO] LEN[2]</span></strong></span><span style="margin: 0px; padding: 0px; font-size: 11.7px;">,&nbsp;</span><span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong><span style="margin: 0px; padding: 0px;">===&gt;error_gwy_to_msg_inter: rc_gwy[91], error de tiempo de espera, timeout</span></strong></span>&nbsp;)</li>
    <li>El formateador&nbsp;<strong>FSWPACIF&nbsp;</strong>no enviar&aacute; respuesta alguna al m&oacute;dulo&nbsp;<strong>SWRSP</strong>. (Verificar en el log:&nbsp;<span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong><span style="margin: 0px; padding: 0px;">===&gt;error_gwy_to_msg_inter: Para error en gwy [91], no se envia respuesta</span></strong></span>)</li>
    <li>El m&oacute;dulo&nbsp;<strong>TXNTIMER&nbsp;</strong>genera un mensaje por timeout 0190 y lo envia al m&oacute;dulo&nbsp;<strong>SWRSP.&nbsp;</strong>(Verificar en el log:&nbsp;<span style="margin: 0px; padding: 0px; color: rgb(51, 102, 255);"><strong>txntimer     M[0190]</strong></span>)</li>
    <li>El m&oacute;dulo&nbsp;<strong>SWRSP&nbsp;</strong>recibe un mensaje 0190 y hace matching con el mensaje 0100. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;matching_msg: HIZO MATCHING.</strong></span>)</li>
    <li>El m&oacute;dulo&nbsp;<strong>SWRSP&nbsp;</strong>inserta un mensaje 0420 en la&nbsp;<strong>TXNSAF&nbsp;</strong>y actualiza el mensaje 0100 en la&nbsp;<strong>TXNLOG&nbsp;</strong>con el status&nbsp;0110 y codigo de respuesta 91. (Verificar en el log:&nbsp;<b style="color: rgb(51, 102, 255);">===&gt; msg.msgtype:420,&nbsp;===&gt;IMP_insert_into_txnsaf: INSERTO EN LA TABLA TXNSAF. y&nbsp;===&gt;update_txn_log: ACTUALIZA TABLA TXNLOG</b>)</li>
    <li>El m&oacute;dulo&nbsp;<strong>SWRSP&nbsp;</strong>envia un mensaje 0110 con codigo de respuesta 91 al proceso&nbsp;<strong>UBINTISO</strong>.</li>
    <li>El proceso&nbsp;<strong>UBINTISO&nbsp;</strong>recibe un mensaje 0110 con codigo de respuesta 91 y lo envia al adquirente. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><span style="margin: 0px; padding: 0px;"><strong><span style="margin: 0px; padding: 0px;">===&gt;msg_inter_to_iso_8583: MSGTYPE[110].</span></strong></span>&nbsp;y&nbsp;<span style="margin: 0px; padding: 0px;"><strong><span style="margin: 0px; padding: 0px;">===&gt;msg_inter_to_iso_8583: B039[91]</span></strong></span></span><span style="margin: 0px; padding: 0px;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px; background-color: rgb(238, 238, 238); color: rgb(51, 102, 255);"><span style="margin: 0px; padding: 0px;">)</span></span></li>
    <li>El proceso&nbsp;<strong>SNDSAF&nbsp;</strong>envia un mensaje echo 0800 al modulo&nbsp;<strong>SWREQ</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;debo_enviar_saf: Send Echo, monitor .</strong></span>)</li>
    <li>El modulo&nbsp;<strong>SWREQ&nbsp;</strong>recibe un mensaje 0800 y lo envia al proceso&nbsp;<strong>FSWPACIF</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;snd_bco: Enviare a = (FSWPACIF) envsw:0.</strong></span>)</li>
    <li>El proceso&nbsp;<strong>FSWPACIF&nbsp;</strong>recibe un mensaje 0800 y lo envia al gateway&nbsp;<strong>GWSSISGO</strong>.&nbsp; (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;IF_txrx: Sending Message to SRV[GWSSISGO] </strong></span>)</li>
    <li>El gateway&nbsp;<strong>GWSSISGO&nbsp;</strong>recibe y envia un mensaje 0800 al autorizador&nbsp;<strong>SISGO</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;sendMsgToHost: Enviando requerimiento de 2429 bytes hacia autorizador.</strong></span>)</li>
    <li>El autorizador&nbsp;<strong>SISGO&nbsp;</strong>recibe un mensaje 0800 y responde con un mensaje 0810 el cual lo envia al gateway&nbsp;<strong>GWSSISGO</strong>.</li>
    <li>El gateway&nbsp;<strong>GWSSISGO&nbsp;</strong>recibe un mensaje 0810 con codigo de respuesta 00 y lo envia al proceso&nbsp;<strong>FSWPACIF</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;six_applic: 2429 bytes message read from app server(GWYSISGO&nbsp;</strong></span>)</li>
    <li>El proceso&nbsp;<strong>FSWPACIF&nbsp;</strong>recibe un mensaje 0810 con codigo de respuesta 00 y lo envia al&nbsp;<strong>SWRSP</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;IF_tx: Sending [8016]bytes to appl[SWRSP].</strong></span>)</li>
    <li>El modulo&nbsp;<strong>SWRSP&nbsp;</strong>recibe un mensaje 0810 con codigo de respuesta 00 y lo envia al proceso&nbsp;<strong>SNDSAF</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;snd_term: msgtype [810] appl (SNDSAF).</strong></span>)</li>
    <li>El proceso&nbsp;<strong>SNDSAF&nbsp;</strong>busca y encuentra en la tabla&nbsp;<strong>TXNSAF&nbsp;</strong>un mensaje 0420. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;snd_term: msgtype [810] appl (SNDSAF).</strong></span>)</li>
    <li>El proceso&nbsp;<strong>SNDSAF&nbsp;</strong>envia el mensaje 0420 al modulo&nbsp;<strong>SWREQ</strong>.</li>
    <li>El modulo&nbsp;<strong>SWREQ&nbsp;</strong>recibe un mensaje 0420 y lo envia al proceso&nbsp;<strong>FSWPACIF</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;snd_bco: Enviare a = (FSWPACIF) envsw:0.</strong></span>)</li>
    <li>El proceso&nbsp;<strong>FSWPACIF&nbsp;</strong>recibe un mensaje 0420 y lo envia al gateway&nbsp;<strong>GWSSISGO</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;IF_txrx: Sending Message to SRV[GWSSISGO]</strong></span>)</li>
    <li>El gateway&nbsp;<strong>GWSSISGO&nbsp;</strong>recibe y envia un mensaje 0420 al autorizador&nbsp;<strong>SISGO</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;sendMsgToHost: Enviando requerimiento de 2429 bytes hacia autorizador.</strong></span>)</li>
    <li>El autorizador&nbsp;<strong>SISGO&nbsp;</strong>recibe un mensaje 0420 y responde con un mensaje 0430 el cual lo envia al gateway&nbsp;<strong>GWSSISGO</strong>.</li>
    <li>El gateway&nbsp;<strong>GWSSISGO&nbsp;</strong>recibe un mensaje 0430 con codigo de respuesta 00 y lo envia al proceso&nbsp;<strong>FSWPACIF</strong>.(Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;six_applic: 2429 bytes message read from app server(GWYSISGO&nbsp;</strong></span>)</li>
    <li>El proceso&nbsp;<strong>FSWPACIF&nbsp;</strong>recibe un mensaje 0430 con codigo de respuesta 00 y lo envia al&nbsp;<strong>SWRSP</strong>. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;iso_8583_to_msg_inter: DE039[00]. y&nbsp;===&gt;IF_tx: Message sent to appl[SWRSP].&nbsp;</strong></span>)</li>
    <li>El modulo&nbsp;<strong>SWRSP&nbsp;</strong>recibe un mensaje 0430 con codigo de respuesta 00 y lo envia al proceso&nbsp;<strong>SNDSAF.&nbsp;</strong>(Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;snd_saf: Envia Rpta SAF.&nbsp;</strong></span>)</li>
    <li>El proceso&nbsp;<strong>SNDSAF&nbsp;</strong>actualiza el campo status en la tabla&nbsp;<strong>TXNSAF&nbsp;</strong>con valor 2. (Verificar en el log:&nbsp;<span style="color: rgb(51, 102, 255);"><strong>===&gt;IMP_update_txnsaf: Actualizo EN LA TABLA TXNSAF.&nbsp;</strong></span>)</li>
</ol>
<p><strong>Base de datos:</strong></p>
<p><span style="color: rgb(153, 51, 0);"><u><strong>TXNLOG</strong></u></span></p>
<p><span style="font-family: &quot;Trebuchet MS&quot;, Verdana, Arial, sans-serif; font-size: 11.7px;">Para validar el registro en bd, ejecutar el siguiente query:</span></p>
<ul>
    <li>select * from txnlog where trace = '<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong>TTTTTT</strong></span>' and time_local = '<span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);"><strong>HHMMSS</strong></span>' and date_local = ''<span style="margin: 0px; padding: 0px; color: rgb(51, 153, 102);"><strong>YYYYMMDD</strong></span>';</li>
</ul>
<p>Donde:</p>
<ul>
    <li><strong><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">TTTTTT</span></strong>: Es el n&uacute;mero del trace de la transacci&oacute;n.</li>
    <li><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);"><strong>HHMMSS</strong></span>: Es la hora local de la transacci&oacute;n.</li>
    <li><span style="margin: 0px; padding: 0px; color: rgb(51, 153, 102);"><strong>YYYYMMDD</strong></span>: Es la fecha local de la transacci&oacute;n.</li>
</ul>
<p>&nbsp; En el log:</p>
<ul>
    <li><span style="font-family: &quot;Courier New&quot;;">===&gt;iso_8583_to_msg_inter: B011[<strong style="font-family: Arial, Verdana, sans-serif;"><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">TTTTTT</span></strong>]</span></li>
    <li><span style="font-family: &quot;Courier New&quot;;">===&gt;iso_8583_to_msg_inter: B012[<strong style="color: rgb(0, 0, 255); font-family: Arial, Verdana, sans-serif;">HHMMSS</strong>].</span></li>
    <li><span style="font-family: &quot;Courier New&quot;;">===&gt;iso_8583_to_msg_inter: B013[<strong style="color: rgb(51, 153, 102); font-family: Arial, Verdana, sans-serif;">MMDD</strong>].</span></li>
</ul>
<p><u style="color: rgb(153, 51, 0);"><strong>TXNSAF</strong></u></p>
<p>&nbsp;Para validar el registro en bd, ejecutar el siguiente query:</p>
<ul>
    <li>select * from txnsaf where trace = '<span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"><strong>TTTTTT</strong></span>' and time_local = '<span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);"><strong>HHMMSS</strong></span>' and date_local = ''<span style="margin: 0px; padding: 0px; color: rgb(51, 153, 102);"><strong>YYYYMMDD</strong></span>';</li>
</ul>
<div>Donde:</div>
<ul>
    <li><strong><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">TTTTTT</span></strong>: Es el n&uacute;mero del trace de la transacci&oacute;n.</li>
    <li><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);"><strong>HHMMSS</strong></span>: Es la hora local de la transacci&oacute;n.</li>
    <li><span style="margin: 0px; padding: 0px; color: rgb(51, 153, 102);"><strong>YYYYMMDD</strong></span>: Es la fecha local de la transacci&oacute;n.</li>
</ul>
<div>&nbsp; En el log:</div>
<ul>
    <li>===&gt;iso_8583_to_msg_inter: B011[<strong><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">TTTTTT</span></strong>]</li>
    <li>===&gt;iso_8583_to_msg_inter: B012[<strong style="color: rgb(0, 0, 255);">HHMMSS</strong>].</li>
    <li>===&gt;iso_8583_to_msg_inter: B013[<strong style="color: rgb(51, 153, 102);">MMDD</strong>].</li>
</ul>
<p>&nbsp;En el registro encontrado de la tabla TXNSAF, los campos&nbsp;<span style="margin: 0px; padding: 0px;"><strong>status</strong></span>&nbsp;y&nbsp;<strong>resp_code</strong><span style="margin: 0px; padding: 0px;"><strong>&nbsp;</strong></span>deben ser iguales a <b>2&nbsp;</b>y&nbsp;<span style="margin: 0px; padding: 0px;"><strong>000</strong></span>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>]]></expectedresults>
</testcase>
</testcases>